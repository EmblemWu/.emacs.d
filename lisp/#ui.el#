;; File: ui.el

(global-display-line-numbers-mode)
(menu-bar-mode -1)
(tool-bar-mode -1)
(scroll-bar-mode -1)
(setq initial-buffer-choice t)

;; (with-eval-after-load 'nyan-mode
;;   (setq mode-line-format
;;         (list
;;          '(:eval (list (nyan-create))))))

;; ---------------------------
;; Fonts
;; ---------------------------
(defun emblem-apply-fonts (&optional frame)
  "Apply font settings to FRAME (or the selected frame)."
  (with-selected-frame (or frame (selected-frame))
    ;; No fallbacks: only set fonts when the requested family exists.
    (when (member "Roboto Mono" (font-family-list))
      (set-face-attribute 'default nil :family "Roboto Mono" :height 150 :weight 'medium))
    (when (member "Fira Sans" (font-family-list))
      (set-face-attribute 'variable-pitch nil :family "Fira Sans" :height 150 :weight 'bold))
    (when (and (facep 'fixed-pitch-serif) (member "Fira Code" (font-family-list)))
      (set-face-attribute 'fixed-pitch-serif nil :family "Fira Code" :height 210 :weight 'regular))))

;; Apply on startup and for new frames (daemon/gui).
(add-hook 'after-init-hook #'emblem-apply-fonts)
(add-hook 'after-make-frame-functions #'emblem-apply-fonts)

;; 中文字体映射，避免中英文混排时 fallback 不一致（按需调整）
;; 优先使用苹方；如果没有则尝试 Noto Sans CJK / 思源黑体
(let ((cn-font (or (car (seq-filter (lambda (f) (member f (font-family-list)))
                                    '("PingFang SC" "Noto Sans CJK SC" "Source Han Sans SC" "Hiragino Sans GB")))
                   nil)))
  (when cn-font
    (set-fontset-font t 'han (font-spec :family cn-font :size 16))
    (set-fontset-font t 'kana (font-spec :family cn-font :size 16))
    (set-fontset-font t 'cjk-misc (font-spec :family cn-font :size 16))))

;; 等宽中文（如代码块里汉字对齐）可选：
(when (member "PingFang SC" (font-family-list))
  ;; 将固定宽度中文映射到苹方，防止等宽字符错位
  (set-fontset-font "fontset-default" 'han (font-spec :family "PingFang SC" :size 16)))

;; ---------------------------
;; Themes
;; ---------------------------
;; auto-dark 配置（包在 packages.el 中声明）
;; 默认不启用，且防止它在启动时抢主题；若需自动切换，请手动 M-x auto-dark-mode
(with-eval-after-load 'auto-dark
  ;; 确保 alabaster 主题可被找到（local theme/ 或 straight 安装）
  ;; (add-to-list 'custom-theme-load-path (expand-file-name "theme" user-emacs-directory))
  ;; (let ((alabaster-dir (when-let ((lib (locate-library "alabaster-theme")))
  ;;                        (file-name-directory lib))))
  ;;   (when alabaster-dir
  ;;     (add-to-list 'custom-theme-load-path alabaster-dir)))
  (setq auto-dark-themes '((alabaster-themes-dark-mono) (alabaster-light-mono))
        auto-dark-polling-interval-seconds 5
        auto-dark-allow-osascript nil
        auto-dark-allow-powershell nil))

(with-eval-after-load 'olivetti-mode
  (setq display-line-numbers-mode nil))

(setq display-line-numbers-mode 'nil)
;; macOS 图形细节：移除装饰 + 最大化（适合 everywhere 浮窗）
;; 如需系统原生全屏，把 fullscreen 改为 'fullboth 并保留 (undecorated . nil)
;; (setq default-frame-alist
;;       '((undecorated . t)
;;         (fullscreen . maximized)
;;         (ns-transparent-titlebar . t)))

(setq display-line-numbers 'relative)
(provide 'ui)
